 #!/usr/bin/env bash
set -euo pipefail

# === User check ===
CURRENT_USER=$(whoami)
if [[ "$CURRENT_USER" != "carterhuang" ]]; then
  echo "❌ This script must be run as carterhuang (currently: $CURRENT_USER)."
  exit 1
fi

# === Password file ===
PASSWORD_FILE="$HOME/programfiles/p.txt"
if [[ ! -r "$PASSWORD_FILE" ]]; then
  echo "❌ Cannot read password file at $PASSWORD_FILE."
  exit 1
fi

# === Homebrew check ===
if command -v brew >/dev/null 2>&1; then
  echo "✅ Homebrew is already installed. Nothing to do."
  exit 0
fi

# === Read password ===
PASSWORD=$(<"$PASSWORD_FILE")

# Pre‑authenticate sudo (so you only get the one password prompt, if necessary)
echo "$PASSWORD" | sudo -S -v

# Run the Homebrew installer non‑interactively
export NONINTERACTIVE=1
echo "$PASSWORD" | \
  sudo -S --prompt="" /bin/bash -c "\
    /usr/bin/env bash -c \"\$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\" \
  "

echo "🎉 Homebrew installation complete!"